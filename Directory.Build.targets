<Project>
  <Target Name="PreBuildAutomation" BeforeTargets="BeforeBuild">
    <!-- Inject Cyberpunk Header -->
    <Message Text="⛓️ Injecting cyberpunk headers into .cs files..." Importance="High" />
    <Exec Command="powershell -ExecutionPolicy Bypass -File &quot;$(MSBuildThisFileDirectory)Inject-CyberHeader.ps1&quot;" />

    <!-- Run dotnet-csharpier from root -->
    <Message Text="🧽 Running CSharpier to verify code formatting..." Importance="High" />
    <Exec
      Command="dotnet-csharpier ."
      WorkingDirectory="$(MSBuildThisFileDirectory)"
      ContinueOnError="true">
      <Output TaskParameter="ExitCode" PropertyName="CSharpierExitCode" />
    </Exec>

    <!-- Fail build if code is unformatted -->
    <Error Condition="'$(CSharpierExitCode)' != '0'"
           Text="❌ CSharpier formatting check failed. Run 'dotnet-csharpier .' from the repo root to fix formatting." />
  </Target>
</Project>
